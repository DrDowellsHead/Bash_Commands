#!/bin/bash
set -e

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x generate_test_files.sh
chmod +x test_flags.sh
chmod +x test_combinations.sh
chmod +x test_edge_cases.sh
chmod +x ../utils/compare_results.sh

echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤..."
./generate_test_files.sh

echo ""
echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤..."
echo "========================================"

total_tests=0
passed_tests=0
failed_tests=0

run_test_suite() {
    local script="$1"
    local name="$2"
    
    echo ""
    echo "üß™ $name"
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    
    if bash "$script"; then
        echo "‚úÖ $name: –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´"
        return 0
    else
        # –ù–µ –∑–∞–≤–µ—Ä—à–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞
        echo "‚ö†Ô∏è $name: –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ü–†–û–í–ê–õ–ï–ù–´, –ü–†–û–î–û–õ–ñ–ê–ï–ú –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï"
        return 1
    fi
}

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º –æ—à–∏–±–æ–∫ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
if run_test_suite "test_flags.sh" "–¢–µ—Å—Ç—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤"; then
    ((passed_tests+=10))
else
    ((failed_tests+=10))
fi
((total_tests+=10))

if run_test_suite "test_combinations.sh" "–¢–µ—Å—Ç—ã –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–ª–∞–≥–æ–≤"; then
    ((passed_tests+=10))
else
    ((failed_tests+=10))
fi
((total_tests+=10))

if run_test_suite "test_edge_cases.sh" "–¢–µ—Å—Ç—ã –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤"; then
    ((passed_tests+=10))
else
    ((failed_tests+=10))
fi
((total_tests+=10))

echo ""
echo "üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢"
echo "========================================"
echo "–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: $total_tests"
echo "–ü—Ä–æ–π–¥–µ–Ω–æ: $passed_tests"
echo "–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: $failed_tests"
echo ""

if [ $failed_tests -eq 0 ]; then
    echo "üéâüéâüéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í–°–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! üéâüéâüéâ"
    exit 0
else
    echo "‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–µ–Ω—ã, –Ω–æ –≤–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ."
    echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤."
    echo "–î–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
    echo "  echo \"Hello world\" > test.txt"
    echo "  ./s21_grep -i \"hello\" test.txt"
    echo ""
    echo "–ï—Å–ª–∏ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö."
    exit 1
fi